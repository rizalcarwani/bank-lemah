<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bank Lemah ‚Äî Web App</title>
  <style>
    :root{
      --bg0:#070A12;
      --bg1:#0B1020;
      --card:rgba(255,255,255,.06);
      --stroke:rgba(255,255,255,.12);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.68);
      --muted2:rgba(255,255,255,.52);
      --good:#43f4a7;
      --bad:#ff6b8a;
      --a:#7c4dff;
      --b:#21d4fd;

      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --radius2: 26px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }

    [data-theme="light"]{
      --bg0:#F7F8FF;
      --bg1:#EEF2FF;
      --card:rgba(0,0,0,.04);
      --stroke:rgba(0,0,0,.10);
      --text:rgba(12,16,32,.92);
      --muted:rgba(12,16,32,.65);
      --muted2:rgba(12,16,32,.48);
      --shadow: 0 18px 60px rgba(0,0,0,.12);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 15% 12%, rgba(124,77,255,.22), transparent 55%),
        radial-gradient(900px 520px at 82% 18%, rgba(33,212,253,.18), transparent 55%),
        radial-gradient(900px 700px at 55% 85%, rgba(67,244,167,.10), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
    }

    .frame{
      width:min(1920px, 100%);
      min-height:1080px;
      margin:0 auto;
      padding:22px;
      position:relative;
    }
    .frame:before{
      content:"";
      position:absolute; inset:0;
      background:
        linear-gradient(rgba(255,255,255,.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,.05) 1px, transparent 1px);
      background-size: 64px 64px;
      mask-image: radial-gradient(820px 520px at 55% 10%, rgba(0,0,0,1), transparent 70%);
      opacity:.25;
      pointer-events:none;
    }

    .app{
      position:relative;
      display:grid;
      grid-template-columns: 300px 1fr;
      gap:16px;
      align-items:stretch;
      min-height: calc(1080px - 44px);
    }

    .panel{
      border-radius: var(--radius2);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow:hidden;
    }

    /* Sidebar */
    .sidebar{ display:flex; flex-direction:column; padding:14px; }

    .brand{
      display:flex; align-items:center; gap:12px;
      padding:12px;
      border-radius: 18px;
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.10);
    }
    .logo{
      width:42px; height:42px;
      border-radius: 14px;
      position:relative;
      background:
        radial-gradient(18px 18px at 30% 30%, rgba(255,255,255,.25), transparent 60%),
        linear-gradient(135deg, rgba(124,77,255,.95), rgba(33,212,253,.95));
      box-shadow: 0 10px 30px rgba(124,77,255,.18);
      border:1px solid rgba(255,255,255,.18);
      overflow:hidden;
      flex:0 0 auto;
    }
    .logo:before{
      content:"";
      position:absolute; inset:-10px;
      background: conic-gradient(from 220deg, rgba(255,255,255,0), rgba(255,255,255,.35), rgba(255,255,255,0));
      animation: spin 4.8s linear infinite;
      opacity:.55;
    }
    .logo:after{
      content:"BL";
      position:absolute; inset:0;
      display:flex; align-items:center; justify-content:center;
      font-family: var(--mono);
      font-weight: 900;
      color: rgba(255,255,255,.92);
      text-shadow: 0 4px 14px rgba(0,0,0,.25);
      font-size:14px;
      letter-spacing:.4px;
    }
    @keyframes spin{ to{ transform: rotate(360deg);} }

    .brand h1{ margin:0; font-size:14px; letter-spacing:.2px; }
    .brand p{ margin:2px 0 0; font-size:12px; color:var(--muted); }

    .side-meta{
      margin-top:12px;
      padding:12px;
      border-radius: 18px;
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.10);
      display:flex; flex-direction:column; gap:8px;
    }
    .rowline{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      font-size:12px; color:var(--muted);
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.05);
      border:1px solid var(--stroke);
      color: var(--muted);
      font-size:12px;
      white-space:nowrap;
    }
    .dot{ width:10px;height:10px;border-radius:999px; background:var(--bad); box-shadow:0 0 0 4px rgba(255,107,138,.12); }
    .dot.ok{ background:var(--good); box-shadow:0 0 0 4px rgba(67,244,167,.12); }

    .nav{
      margin-top:12px;
      display:flex; flex-direction:column; gap:8px;
      padding:6px;
    }

    .nav a{
      text-decoration:none;
      color: var(--text);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:12px 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      user-select:none;
    }
    .nav a:hover{ background: rgba(255,255,255,.07); }
    .nav a:active{ transform: translateY(1px); }
    .nav a.active{
      background: linear-gradient(135deg, rgba(124,77,255,.70), rgba(33,212,253,.55));
      border-color: rgba(255,255,255,.16);
      box-shadow: 0 18px 50px rgba(33,212,253,.10);
    }
    .nav-left{
      display:flex; align-items:center; gap:10px;
      font-weight:850;
      font-size:12px;
    }
    .ico{
      width:34px;height:34px;border-radius:14px;
      display:flex;align-items:center;justify-content:center;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      font-family: var(--mono);
      font-weight:900;
    }
    .nav small{ color: rgba(255,255,255,.75); font-family:var(--mono); }

    .side-actions{
      margin-top:auto;
      display:flex; gap:10px;
      padding:10px 6px 6px;
    }

    .btn{
      appearance:none;
      border:none;
      cursor:pointer;
      padding:10px 12px;
      border-radius: 14px;
      font-weight:850;
      color: rgba(255,255,255,.92);
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      flex:1;
    }
    [data-theme="light"] .btn{ color: rgba(12,16,32,.92); }
    .btn:hover{ background: rgba(255,255,255,.12); }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      background: linear-gradient(135deg, rgba(124,77,255,.95), rgba(33,212,253,.92));
      border-color: rgba(255,255,255,.18);
      box-shadow: 0 18px 50px rgba(124,77,255,.16);
      color: rgba(255,255,255,.94);
    }
    .btn:disabled{ opacity:.55; cursor:not-allowed; }

    /* Main area */
    .main{ display:flex; flex-direction:column; overflow:hidden; }

    .topbar{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:16px 18px;
      border-bottom:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
    }

    .title-wrap h2{ margin:0; font-size:14px; letter-spacing:.2px; }
    .title-wrap p{ margin:6px 0 0; font-size:12px; color:var(--muted); line-height:1.45; }

    .topbar-right{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap; justify-content:flex-end;
    }
    .badge{
      font-family: var(--mono);
      font-size:11px;
      color: rgba(255,255,255,.82);
      background: rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.12);
      padding:8px 10px;
      border-radius: 999px;
      white-space:nowrap;
    }
    [data-theme="light"] .badge{ color: rgba(12,16,32,.82); }

    .content{
      padding:18px;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:16px;
      align-items:start;
      min-height: 0;
    }

    .card{
      border-radius: var(--radius2);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow:hidden;
    }
    .card .head{
      padding:16px 16px 10px;
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
    }
    .card .head h3{ margin:0; font-size:13px; letter-spacing:.2px; }
    .card .head p{ margin:6px 0 0; font-size:12px; color:var(--muted); line-height:1.45; }
    .card .body{ padding: 12px 16px 16px; }

    .hero{
      padding:16px;
      position:relative;
      overflow:hidden;
    }
    .hero:before{
      content:"";
      position:absolute; inset:-60px;
      background:
        radial-gradient(320px 200px at 20% 10%, rgba(124,77,255,.22), transparent 60%),
        radial-gradient(320px 200px at 70% 30%, rgba(33,212,253,.18), transparent 60%),
        radial-gradient(320px 220px at 40% 90%, rgba(67,244,167,.10), transparent 60%);
      pointer-events:none;
    }
    .hero > *{ position:relative; }

    .big{ font-size:30px; font-weight:950; letter-spacing:.2px; margin:0; }
    .muted{ color:var(--muted); font-size:12px; margin:6px 0 0; line-height:1.45; }
    .kpis{ margin-top:12px; display:flex; gap:10px; flex-wrap:wrap; }

    label{ display:block; font-size:12px; color:var(--muted); margin:10px 0 6px; }
    .input, select{
      width:100%;
      padding:12px 12px;
      border-radius: 14px;
      background: rgba(10,14,28,.50);
      color: var(--text);
      border: 1px solid rgba(255,255,255,.14);
      outline:none;
      transition: border-color .2s ease, box-shadow .2s ease;
    }
    [data-theme="light"] .input, [data-theme="light"] select{
      background: rgba(255,255,255,.70);
      border: 1px solid rgba(0,0,0,.12);
      color: rgba(12,16,32,.92);
    }
    .input:focus, select:focus{
      border-color: rgba(33,212,253,.5);
      box-shadow: 0 0 0 4px rgba(33,212,253,.12);
    }

    .grid2{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
    .helper{ margin-top:10px; font-size:12px; color:var(--muted2); line-height:1.45; }

    .toast{
      margin-top:12px;
      padding:12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.86);
      font-size:12px;
      line-height:1.45;
      display:none;
    }
    [data-theme="light"] .toast{ color: rgba(12,16,32,.86); }
    .toast.show{ display:block; }
    .toast.ok{ border-color: rgba(67,244,167,.35); background: rgba(67,244,167,.10); }
    .toast.bad{ border-color: rgba(255,107,138,.35); background: rgba(255,107,138,.10); }

    .history{ padding: 0 0 10px; }
    .history-item{
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
      padding:12px 16px;
      border-top:1px solid rgba(255,255,255,.08);
    }
    .history-item:first-child{ border-top:none; }
    .hi-left{ display:flex; gap:10px; align-items:flex-start; }
    .icon{
      width:38px; height:38px;
      border-radius: 14px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      display:flex; align-items:center; justify-content:center;
      font-family: var(--mono);
      font-weight:900;
      color: rgba(255,255,255,.86);
      flex:0 0 auto;
    }
    [data-theme="light"] .icon{ color: rgba(12,16,32,.86); }
    .hi-title{ margin:0; font-weight:900; font-size:13px; }
    .hi-sub{ margin:4px 0 0; color: var(--muted); font-size:12px; }
    .amt{
      text-align:right;
      font-family: var(--mono);
      font-weight:900;
      font-size:12px;
      white-space:nowrap;
    }
    .amt.negative{ color: rgba(255,107,138,.92); }
    .amt.positive{ color: rgba(67,244,167,.92); }

    .fade{ animation: fadeIn .22s ease both; }
    @keyframes fadeIn{ from{ opacity:0; transform: translateY(6px); } to{ opacity:1; transform: translateY(0); } }

    footer{
      padding:10px 18px 14px;
      color: var(--muted2);
      font-size:12px;
      display:flex; justify-content:space-between; gap:12px;
      border-top:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.02);
    }

    .link{
      color: inherit;
      font-weight: 900;
      text-decoration: none;
      border-bottom: 1px dashed rgba(255,255,255,.35);
    }
    [data-theme="light"] .link{ border-bottom-color: rgba(0,0,0,.25); }

    @media (max-width: 1100px){
      .app{ grid-template-columns: 1fr; }
      .content{ grid-template-columns: 1fr; }
      .frame{ min-height: auto; }
    }
  </style>
</head>

<body>
  <div class="frame">
    <div class="app">
      <!-- SIDEBAR -->
      <aside class="panel sidebar" aria-label="Sidebar">
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <div>
            <h1>Bank Lemah</h1>
            <p>Digital banking web app</p>
          </div>
        </div>

        <div class="side-meta">
          <div class="rowline">
            <span>Status</span>
            <span class="pill"><span id="statusDot" class="dot" aria-hidden="true"></span><span id="statusText">Belum login</span></span>
          </div>
          <div class="rowline">
            <span>Rek</span>
            <span id="acctText" style="font-family:var(--mono);font-weight:900;">‚Äî</span>
          </div>
          <div class="rowline">
            <span>Tier</span>
            <span id="tierText" style="font-weight:900;">‚Äî</span>
          </div>
        </div>

        <nav class="nav" aria-label="Navigation">
          <a href="#/signup" data-route="signup">
            <div class="nav-left"><span class="ico">üìù</span>Sign Up</div>
            <small>New</small>
          </a>
          <a href="#/login" data-route="login">
            <div class="nav-left"><span class="ico">üîê</span>Login</div>
            <small>Auth</small>
          </a>
          <a href="#/dashboard" data-route="dashboard">
            <div class="nav-left"><span class="ico">üè¶</span>Dashboard</div>
            <small>Home</small>
          </a>
          <a href="#/transfer" data-route="transfer">
            <div class="nav-left"><span class="ico">‚Üó</span>Transfer</div>
            <small>Send</small>
          </a>
          <a href="#/flight" data-route="flight">
            <div class="nav-left"><span class="ico">‚úà</span>Tiket Pesawat</div>
            <small>Buy</small>
          </a>
        </nav>

        <div class="side-actions">
          <button id="btnTheme" class="btn" type="button">Light</button>
          <button id="btnLogout" class="btn primary" type="button" disabled>Logout</button>
        </div>
      </aside>

      <!-- MAIN -->
      <section class="panel main" aria-label="Main">
        <div class="topbar">
          <div class="title-wrap">
            <h2 id="pageTitle">Sign Up</h2>
            <p id="pageDesc">Buat akun Bank Lemah untuk mulai menggunakan fitur.</p>
          </div>
          <div class="topbar-right">
            <span class="badge" id="sessionBadge">Secure Session</span>
            <span class="badge" id="balanceBadge">Saldo: Rp 0</span>
          </div>
        </div>

        <div class="content" id="viewRoot"></div>

        <footer>
  <div>¬© <span id="year"></span> Bank Lemah ‚Äî Perbankan dan Kebijakan Moneter</div>
</footer>
      </section>
    </div>
  </div>

  <script>
    // =========================
    //   DEMO NOTES (important)
    // =========================
    // - Ini demo front-end only.
    // - Password disimpan plain di localStorage (TIDAK aman).
    // - Untuk produksi: gunakan backend + hashing + token/session, jangan simpan password di client.

    // ========= STORAGE =========
    const STORAGE_KEY = "bl_users_v1";
    function loadUsers(){
      try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }
      catch{ return []; }
    }
    function saveUsers(users){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(users));
    }
    function findUserByIdentifier(users, identifier){
      const id = (identifier || "").trim().toLowerCase();
      return users.find(u => (u.email.toLowerCase() === id) || (u.username.toLowerCase() === id));
    }

    // ========= STATE =========
    const state = {
      theme: localStorage.getItem("bl_theme") || "dark",
      loggedIn: false,
      user: null,
      balance: 0,
      history: []
    };

    // ========= HELPERS =========
    const el = (id) => document.getElementById(id);
    const rupiah = (n) => {
      const v = Math.max(0, Math.floor(Number(n) || 0));
      return "Rp " + v.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    };
    function toast(targetId, message, type){
      const t = el(targetId);
      t.className = "toast show " + (type || "");
      t.textContent = message;
      clearTimeout(t.__t);
      t.__t = setTimeout(() => { t.className="toast"; t.textContent=""; }, 4500);
    }
    function pad(x){ return String(x).padStart(2,"0"); }
    function fmtTime(d){ return `${pad(d.getHours())}:${pad(d.getMinutes())}`; }
    function randAcct(){ return "12" + String(Math.floor(10000000 + Math.random() * 89999999)); }

    function setTheme(theme){
      state.theme = theme;
      document.documentElement.setAttribute("data-theme", theme);
      localStorage.setItem("bl_theme", theme);
      el("btnTheme").textContent = theme === "dark" ? "Light" : "Dark";
    }

    function setLoggedInUI(){
      const on = state.loggedIn;
      el("statusDot").className = "dot " + (on ? "ok" : "");
      el("statusText").textContent = on ? "Login aktif" : "Belum login";
      el("btnLogout").disabled = !on;

      el("acctText").textContent = on ? state.user.acct : "‚Äî";
      el("tierText").textContent = on ? state.user.tier : "‚Äî";
      el("balanceBadge").textContent = "Saldo: " + rupiah(on ? state.balance : 0);
      el("sessionBadge").textContent = on ? `Hi, ${state.user.name}` : "Secure Session";
    }

    function pushHistory({ title, sub, amount, kind }){
      state.history.unshift({ t: new Date(), title, sub, amount:Number(amount)||0, kind });
      if(state.history.length > 20) state.history.pop();
    }

    function renderHistoryHTML(){
      if(!state.loggedIn || state.history.length === 0){
        return `
          <div class="history-item">
            <div class="hi-left">
              <div class="icon">i</div>
              <div>
                <p class="hi-title">${state.loggedIn ? "Belum ada transaksi" : "Belum login"}</p>
                <p class="hi-sub">${state.loggedIn ? "Coba transfer atau beli tiket." : "Silakan login terlebih dulu."}</p>
              </div>
            </div>
            <div class="amt">‚Äî</div>
          </div>
        `;
      }

      return state.history.slice(0,8).map(h => {
        const signClass = h.kind === "out" ? "negative" : "positive";
        const sign = h.kind === "out" ? "-" : "+";
        const iconTxt = h.kind === "out" ? "‚Üó" : "‚úà";
        return `
          <div class="history-item">
            <div class="hi-left">
              <div class="icon">${iconTxt}</div>
              <div>
                <p class="hi-title">${h.title}</p>
                <p class="hi-sub">${h.sub} ‚Ä¢ ${fmtTime(h.t)}</p>
              </div>
            </div>
            <div class="amt ${signClass}">${sign}${rupiah(Math.abs(h.amount))}</div>
          </div>
        `;
      }).join("");
    }

    // ========= PAGE META =========
    function setPageMeta(title, desc){
      el("pageTitle").textContent = title;
      el("pageDesc").textContent = desc;
    }

    function guard(){
      if(!state.loggedIn){
        location.hash = "#/login";
        throw new Error("Not logged in");
      }
    }

    // ========= VIEWS =========
    function viewSignup(){
      setPageMeta("Sign Up", "Buat akun Bank Lemah untuk mulai menggunakan fitur.");

      return `
        <div class="card fade">
          <div class="head">
            <div>
              <h3>Buat Akun</h3>
              <p>Isi data berikut. Akun disimpan di browser (localStorage).</p>
            </div>
            <span class="badge">New User</span>
          </div>
          <div class="body">
            <form id="signupForm">
              <label for="name">Nama</label>
              <input id="name" class="input" type="text" placeholder="contoh: Rizal" required />

              <div class="grid2">
                <div>
                  <label for="username">Username</label>
                  <input id="username" class="input" type="text" placeholder="contoh: rizal" required />
                </div>
                <div>
                  <label for="email">Email</label>
                  <input id="email" class="input" type="email" placeholder="contoh: rizal@banklemah.id" required />
                </div>
              </div>

              <div class="grid2">
                <div>
                  <label for="password">Password</label>
                  <input id="password" class="input" type="password" placeholder="min 6 karakter" minlength="6" required />
                </div>
                <div>
                  <label for="tier">Tier</label>
                  <select id="tier">
                    <option value="Gold">Gold</option>
                    <option value="Platinum">Platinum</option>
                  </select>
                </div>
              </div>

              <div class="helper">
                <b>Demo:</b> password disimpan plain di localStorage (tidak aman untuk produksi).
              </div>

              <div style="display:flex; gap:10px; margin-top:14px;">
                <button class="btn primary" type="submit" style="flex:1;">Buat Akun</button>
                <button class="btn" type="reset" style="flex:1;">Reset</button>
              </div>

              <div id="signupToast" class="toast" role="status" aria-live="polite"></div>
            </form>

            <div class="helper" style="margin-top:12px;">
              Sudah punya akun? <a class="link" href="#/login">Login di sini</a>.
            </div>
          </div>
        </div>

        <div class="card fade">
          <div class="hero">
            <p class="muted" style="margin:0;">Tips</p>
            <h3 class="big" style="margin-top:6px;">Akun kamu tersimpan di browser.</h3>
            <p class="muted">Kalau pindah device / hapus data browser, akun demo ikut hilang.</p>
            <div class="kpis">
              <span class="pill">üìù Sign Up</span>
              <span class="pill">üîê Login</span>
              <span class="pill">üè¶ Dashboard</span>
            </div>
          </div>
        </div>
      `;
    }

    function viewLogin(){
      setPageMeta("Login", "Masuk untuk menggunakan fitur Bank Lemah.");

      return `
        <div class="card fade">
          <div class="head">
            <div>
              <h3>Masuk Akun</h3>
              <p>Gunakan email atau username yang kamu daftarkan.</p>
            </div>
            <span class="badge">Auth</span>
          </div>
          <div class="body">
            <form id="loginForm">
              <label for="identifier">Email / Username</label>
              <input id="identifier" class="input" type="text" placeholder="contoh: rizal atau rizal@banklemah.id" required />

              <label for="password">Password</label>
              <input id="password" class="input" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />

              <div class="helper">
                Belum punya akun? <a class="link" href="#/signup">Sign Up</a>.
              </div>

              <div style="display:flex; gap:10px; margin-top:14px;">
                <button class="btn primary" type="submit" style="flex:1;">Login</button>
                <button class="btn" type="reset" style="flex:1;">Reset</button>
              </div>

              <div id="authToast" class="toast" role="status" aria-live="polite"></div>
            </form>
          </div>
        </div>

          <div class="card fade">
          <div class="hero">
            <p class="muted" style="margin:0;">Tips</p>
            <h3 class="big" style="margin-top:6px;">Akun kamu tersimpan di browser.</h3>
            <p class="muted">Kalau pindah device / hapus data browser, akun demo ikut hilang.</p>
            <div class="kpis">
              <span class="pill">üìù Sign Up</span>
              <span class="pill">üîê Login</span>
              <span class="pill">üè¶ Dashboard</span>
            </div>
          </div>
        </div>

      `;
    }

    function viewDashboard(){
      guard();
      setPageMeta("Dashboard", "Ringkasan saldo, profil akun, dan aktivitas terbaru.");

      const name = state.user?.name || "‚Äî";
      const acct = state.user?.acct || "‚Äî";
      const tier = state.user?.tier || "‚Äî";

      return `
        <div class="card fade">
          <div class="hero">
            <p class="muted" style="margin:0;">Saldo Rekening</p>
            <h3 class="big">${rupiah(state.balance)}</h3>
            <p class="muted">Halo, <b>${name}</b>. Ini ringkasan akun Bank Lemah kamu.</p>

            <div class="kpis">
              <span class="pill">Rek: <b style="font-family:var(--mono);">${acct}</b></span>
              <span class="pill">Tier: <b>${tier}</b></span>
              <span class="pill">Status: <b>Aktif</b></span>
            </div>

            <div class="helper">
              Cepat akses: <a class="link" href="#/transfer">Transfer</a> ‚Ä¢ <a class="link" href="#/flight">Tiket Pesawat</a>
            </div>
          </div>
        </div>

        <div class="card fade">
          <div class="head">
            <div>
              <h3>Aktivitas Terakhir</h3>
              <p>Log transaksi demo (lokal). Maks 20 item.</p>
            </div>
            <button id="btnClearHistory" class="btn" type="button" style="max-width:160px;">Clear</button>
          </div>
          <div class="history" id="historyList">
            ${renderHistoryHTML()}
          </div>
          <div class="body" style="padding-top:0;">
            <div class="helper">Catatan: ini simulasi UI, bukan transaksi real.</div>
          </div>
        </div>
      `;
    }

    function viewTransfer(){
      guard();
      setPageMeta("Transfer", "Kirim dana ke Bank Lemah atau bank lain (simulasi).");

      return `
        <div class="card fade">
          <div class="head">
            <div>
              <h3>Transfer Dana</h3>
              <p>Masukkan bank tujuan, rekening, nominal, dan catatan (opsional).</p>
            </div>
            <span class="badge">Instant</span>
          </div>
          <div class="body">
            <form id="transferForm">
              <label for="toBank">Bank Tujuan</label>
              <select id="toBank" required>
                <option value="Bank Lemah">Bank Lemah</option>
                <option value="BCA">BCA</option>
                <option value="Mandiri">Mandiri</option>
                <option value="BRI">BRI</option>
                <option value="BNI">BNI</option>
                <option value="CIMB Niaga">CIMB Niaga</option>
              </select>

              <label for="toAccount">No. Rekening Tujuan</label>
              <input id="toAccount" class="input" type="text" inputmode="numeric" placeholder="contoh: 1234567890" required />

              <div class="grid2">
                <div>
                  <label for="amount">Nominal (Rp)</label>
                  <input id="amount" class="input" type="number" min="1000" step="1000" placeholder="contoh: 250000" required />
                </div>
                <div>
                  <label for="note">Catatan</label>
                  <input id="note" class="input" type="text" placeholder="opsional" />
                </div>
              </div>

              <div class="helper">Saldo saat ini: <b>${rupiah(state.balance)}</b></div>

              <div style="display:flex; gap:10px; margin-top:14px;">
                <button class="btn primary" type="submit" style="flex:1;">Transfer</button>
                <button class="btn" type="reset" style="flex:1;">Reset</button>
              </div>

              <div id="transferToast" class="toast" role="status" aria-live="polite"></div>
            </form>
          </div>
        </div>

        <div class="card fade">
          <div class="head">
            <div>
              <h3>Preview Aktivitas</h3>
              <p>Transaksi akan tercatat di Dashboard.</p>
            </div>
            <span class="badge">History</span>
          </div>
          <div class="history" id="historyList">
            ${renderHistoryHTML()}
          </div>
        </div>
      `;
    }

    function computeDemoFlightPrice(from, to, airline, pax){
      const base = 450000;
      const routeKey = (from + "->" + to).length;
      const routeFactor = 1 + (routeKey % 7) * 0.06;
      const map = {
        "Garuda Indonesia": 1.55,
        "Citilink": 1.15,
        "Lion Air": 1.00,
        "Batik Air": 1.22,
        "AirAsia": 1.08
      };
      const airlineFactor = map[airline] || 1.1;
      const subtotal = Math.round(base * routeFactor * airlineFactor);
      const total = subtotal * pax;
      return { subtotal, total };
    }

    function viewFlight(){
      guard();
      setPageMeta("Tiket Pesawat", "Simulasi pembelian tiket pesawat (harga demo).");

      const tomorrow = (() => {
        const d = new Date(); d.setDate(d.getDate()+1);
        return d.toISOString().slice(0,10);
      })();

      return `
        <div class="card fade">
          <div class="head">
            <div>
              <h3>Beli Tiket Pesawat</h3>
              <p>Pilih rute, tanggal, penumpang, dan maskapai.</p>
            </div>
            <span class="badge">Travel</span>
          </div>
          <div class="body">
            <form id="flightForm">
              <div class="grid2">
                <div>
                  <label for="fromCity">Dari</label>
                  <select id="fromCity" required>
                    <option value="Jakarta (CGK)">Jakarta (CGK)</option>
                    <option value="Surabaya (SUB)">Surabaya (SUB)</option>
                    <option value="Denpasar (DPS)">Denpasar (DPS)</option>
                    <option value="Medan (KNO)">Medan (KNO)</option>
                    <option value="Makassar (UPG)">Makassar (UPG)</option>
                  </select>
                </div>
                <div>
                  <label for="toCity">Ke</label>
                  <select id="toCity" required>
                    <option value="Denpasar (DPS)">Denpasar (DPS)</option>
                    <option value="Jakarta (CGK)">Jakarta (CGK)</option>
                    <option value="Surabaya (SUB)">Surabaya (SUB)</option>
                    <option value="Medan (KNO)">Medan (KNO)</option>
                    <option value="Makassar (UPG)">Makassar (UPG)</option>
                  </select>
                </div>
              </div>

              <div class="grid2">
                <div>
                  <label for="departDate">Tanggal Berangkat</label>
                  <input id="departDate" class="input" type="date" value="${tomorrow}" required />
                </div>
                <div>
                  <label for="pax">Penumpang</label>
                  <input id="pax" class="input" type="number" min="1" max="9" value="1" required />
                </div>
              </div>

              <label for="airline">Maskapai</label>
              <select id="airline" required>
                <option value="Garuda Indonesia">Garuda Indonesia</option>
                <option value="Citilink">Citilink</option>
                <option value="Lion Air">Lion Air</option>
                <option value="Batik Air">Batik Air</option>
                <option value="AirAsia">AirAsia</option>
              </select>

              <div class="helper" id="priceHint">Estimasi harga akan dihitung otomatis.</div>
              <div class="helper">Saldo saat ini: <b>${rupiah(state.balance)}</b></div>

              <div style="display:flex; gap:10px; margin-top:14px;">
                <button class="btn primary" type="submit" style="flex:1;">Beli Tiket</button>
                <button class="btn" type="reset" style="flex:1;">Reset</button>
              </div>

              <div id="flightToast" class="toast" role="status" aria-live="polite"></div>
            </form>
          </div>
        </div>

        <div class="card fade">
          <div class="head">
            <div>
              <h3>Aktivitas Terakhir</h3>
              <p>Riwayat transaksi (lokal).</p>
            </div>
            <span class="badge">History</span>
          </div>
          <div class="history" id="historyList">
            ${renderHistoryHTML()}
          </div>
        </div>
      `;
    }

    // ========= ROUTER =========
    const routes = {
      signup: viewSignup,
      login: viewLogin,
      dashboard: viewDashboard,
      transfer: viewTransfer,
      flight: viewFlight
    };

    function setActiveNav(routeKey){
      document.querySelectorAll('.nav a').forEach(a => {
        a.classList.toggle("active", a.dataset.route === routeKey);
      });
    }

    function render(){
      const hash = location.hash || "#/signup";
      const routeKey = (hash.split("/")[1] || "signup").toLowerCase();
      const viewFn = routes[routeKey] || routes.signup;

      setActiveNav(routeKey);

      try{
        el("viewRoot").innerHTML = viewFn();
      }catch(e){
        return; // guard redirect
      }

      bindViewEvents(routeKey);
      setLoggedInUI();
    }

    // ========= VIEW EVENTS =========
    function bindViewEvents(routeKey){
      if(routeKey === "signup"){
        const form = document.getElementById("signupForm");
        form.addEventListener("submit", (e) => {
          e.preventDefault();
          const name = document.getElementById("name").value.trim();
          const username = document.getElementById("username").value.trim();
          const email = document.getElementById("email").value.trim().toLowerCase();
          const password = document.getElementById("password").value;
          const tier = document.getElementById("tier").value;

          if(name.length < 2){
            toast("signupToast", "Nama terlalu pendek.", "bad"); return;
          }
          if(username.length < 3){
            toast("signupToast", "Username minimal 3 karakter.", "bad"); return;
          }
          if(!email.includes("@")){
            toast("signupToast", "Email tidak valid.", "bad"); return;
          }
          if(password.length < 6){
            toast("signupToast", "Password minimal 6 karakter.", "bad"); return;
          }

          const users = loadUsers();
          const exists = users.some(u =>
            u.username.toLowerCase() === username.toLowerCase() ||
            u.email.toLowerCase() === email
          );
          if(exists){
            toast("signupToast", "Username atau email sudah terdaftar.", "bad");
            return;
          }

          // create user
          const newUser = {
            id: crypto?.randomUUID ? crypto.randomUUID() : String(Date.now()),
            name,
            username,
            email,
            password, // demo only
            tier,
            acct: randAcct(),
            createdAt: new Date().toISOString()
          };

          users.push(newUser);
          saveUsers(users);

          toast("signupToast", "Akun berhasil dibuat! Mengalihkan ke Login‚Ä¶", "ok");
          setTimeout(() => { location.hash = "#/login"; }, 500);
        });
      }

      if(routeKey === "login"){
        const form = document.getElementById("loginForm");
        form.addEventListener("submit", (e) => {
          e.preventDefault();
          const identifier = document.getElementById("identifier").value.trim();
          const password = document.getElementById("password").value;

          const users = loadUsers();
          const user = findUserByIdentifier(users, identifier);

          if(!user){
            toast("authToast", "Akun tidak ditemukan. Silakan Sign Up dulu.", "bad");
            return;
          }
          if(user.password !== password){
            toast("authToast", "Password salah.", "bad");
            return;
          }

          // login success
          state.loggedIn = true;
          state.user = { name: user.name, acct: user.acct, tier: user.tier, username: user.username, email: user.email };
          state.balance = 12500000 + (String(user.username).length * 250000); // demo saldo awal
          state.history = [];

          setLoggedInUI();
          toast("authToast", "Login berhasil. Mengalihkan ke Dashboard‚Ä¶", "ok");
          setTimeout(() => { location.hash = "#/dashboard"; }, 400);
        });
      }

      if(routeKey === "dashboard"){
        const btn = document.getElementById("btnClearHistory");
        btn.addEventListener("click", () => {
          state.history = [];
          document.getElementById("historyList").innerHTML = renderHistoryHTML();
        });
      }

      if(routeKey === "transfer"){
        const form = document.getElementById("transferForm");
        form.addEventListener("submit", (e) => {
          e.preventDefault();
          const bank = document.getElementById("toBank").value;
          const toAcc = document.getElementById("toAccount").value.trim();
          const amount = Number(document.getElementById("amount").value);
          const note = document.getElementById("note").value.trim();

          if(toAcc.length < 6){
            toast("transferToast", "No. rekening tujuan tidak valid.", "bad"); return;
          }
          if(!Number.isFinite(amount) || amount < 1000){
            toast("transferToast", "Nominal minimal Rp 1.000.", "bad"); return;
          }
          if(amount > state.balance){
            toast("transferToast", "Saldo tidak cukup untuk transfer ini.", "bad"); return;
          }

          state.balance -= amount;
          pushHistory({
            title: `Transfer ke ${bank}`,
            sub: `${toAcc}${note ? " ‚Ä¢ " + note : ""}`,
            amount,
            kind: "out"
          });

          setLoggedInUI();
          document.getElementById("historyList").innerHTML = renderHistoryHTML();
          toast("transferToast", `Transfer berhasil: -${rupiah(amount)} ke ${bank}.`, "ok");
          form.reset();
        });
      }

      if(routeKey === "flight"){
        const fromEl = document.getElementById("fromCity");
        const toEl = document.getElementById("toCity");
        const paxEl = document.getElementById("pax");
        const airEl = document.getElementById("airline");
        const priceHint = document.getElementById("priceHint");

        function updatePrice(){
          const from = fromEl.value;
          const to = toEl.value;
          const pax = Number(paxEl.value || 1);
          const airline = airEl.value;

          const { subtotal, total } = computeDemoFlightPrice(from, to, airline, pax);
          priceHint.innerHTML = `Estimasi: <b>${rupiah(subtotal)}</b> / pax ‚Ä¢ Total <b>${rupiah(total)}</b> (√ó${pax})`;
          return total;
        }

        ["change","input"].forEach(evt => {
          fromEl.addEventListener(evt, updatePrice);
          toEl.addEventListener(evt, updatePrice);
          paxEl.addEventListener(evt, updatePrice);
          airEl.addEventListener(evt, updatePrice);
        });

        updatePrice();

        const form = document.getElementById("flightForm");
        form.addEventListener("submit", (e) => {
          e.preventDefault();
          const from = fromEl.value;
          const to = toEl.value;
          const date = document.getElementById("departDate").value;
          const pax = Number(paxEl.value || 1);
          const airline = airEl.value;

          if(from === to){
            toast("flightToast", "Kota asal & tujuan tidak boleh sama.", "bad"); return;
          }
          if(!date){
            toast("flightToast", "Tanggal berangkat wajib diisi.", "bad"); return;
          }
          if(!Number.isFinite(pax) || pax < 1){
            toast("flightToast", "Jumlah penumpang tidak valid.", "bad"); return;
          }

          const total = updatePrice();
          if(total > state.balance){
            toast("flightToast", "Saldo tidak cukup untuk beli tiket ini.", "bad"); return;
          }

          state.balance -= total;
          pushHistory({
            title: `Tiket Pesawat (${airline})`,
            sub: `${from} ‚Üí ${to} ‚Ä¢ ${date} ‚Ä¢ ${pax} pax`,
            amount: total,
            kind: "out"
          });

          setLoggedInUI();
          document.getElementById("historyList").innerHTML = renderHistoryHTML();
          toast("flightToast", `Berhasil beli tiket: -${rupiah(total)}.`, "ok");
          form.reset();
          updatePrice();
        });

        form.addEventListener("reset", () => setTimeout(updatePrice, 0));
      }
    }

    // ========= GLOBAL EVENTS =========
    el("btnLogout").addEventListener("click", () => {
      state.loggedIn = false;
      state.user = null;
      state.balance = 0;
      state.history = [];
      setLoggedInUI();
      location.hash = "#/login";
    });

    el("btnTheme").addEventListener("click", () => {
      setTheme(state.theme === "dark" ? "light" : "dark");
    });

    window.addEventListener("hashchange", render);

    // ========= INIT =========
    el("year").textContent = new Date().getFullYear();
    setTheme(state.theme);
    setLoggedInUI();
    if(!location.hash) location.hash = "#/signup";
    render();
  </script>
</body>
</html>
